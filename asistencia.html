<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marcado de Asistencia</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-5 text-center">
    <div class="card p-4 mx-auto" style="max-width: 400px; border-radius: 20px;">
        <h3>üìç Registro Venecia</h3>
        <p class="text-muted">Selecciona tu nombre</p>
        <select id="user" class="form-select mb-3"></select>
        <button class="btn btn-success btn-lg w-100" onclick="marcar()">MARCAR ENTRADA</button>
        <div id="msg" class="mt-3"></div>
    </div>
</div>

<script>
    const firebaseConfig = { databaseURL: "https://venecia-control-default-rtdb.firebaseio.com/" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    db.ref('asistencias/personal').on('value', s => {
        const sel = document.getElementById('user'); sel.innerHTML = "";
        s.forEach(child => {
            sel.innerHTML += `<option value="${child.val().nombre}">${child.val().nombre}</option>`;
        });
    });

    function marcar() {
        const u = document.getElementById('user').value;
        const now = new Date();
        const hora = now.getHours() + ":" + now.getMinutes().toString().padStart(2, '0');
        
        // Calcular tardanza (ejemplo despu√©s de las 08:30)
        let minTarde = 0;
        if(now.getHours() >= 8 && now.getMinutes() > 30) {
            minTarde = ((now.getHours() - 8) * 60) + (now.getMinutes() - 30);
        }

        db.ref('asistencias/diarias').push({
            nombre: u,
            hora: hora,
            fecha: now.toLocaleDateString(),
            tarde: minTarde
        }).then(() => {
            document.getElementById('msg').innerHTML = "<div class='alert alert-success'>‚úÖ Registro exitoso</div>";
        });
    }
</script>
</body>
</html>
